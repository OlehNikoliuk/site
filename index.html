<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Push-Up Tracker 15 Weeks</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        body { font-family: sans-serif; background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        .input-hidden { background: transparent; border: none; outline: none; text-align: center; width: 100%; }
        
        /* –°—Ç–∏–ª—å –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
        input[type="date"]::-webkit-calendar-picker-indicator {
            background: transparent; bottom: 0; color: transparent; cursor: pointer;
            height: auto; left: 0; position: absolute; right: 0; top: 0; width: auto;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        window.onerror = function(msg, url, line) {
            document.getElementById('root').innerHTML = '<div style="color:#ef4444; padding:20px; text-align:center; background:#1e293b; height:100vh; display:flex; flex-direction:column; justify-content:center;"><h3>–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞</h3><p>'+msg+'</p><button onclick="location.reload()" style="margin-top:20px; padding:10px; background:#3b82f6; color:white; border-radius:10px;">–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button></div>';
        };
    </script>

    <script type="text/babel">
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyCsj8b0Nsen4ntqTA2cMA_OAG3JnHVC5lw",
            authDomain: "gymtracker-8896f.firebaseapp.com",
            projectId: "gymtracker-8896f",
            storageBucket: "gymtracker-8896f.firebasestorage.app",
            messagingSenderId: "1005248607580",
            appId: "1:1005248607580:web:137561bf40a4490c62bd99",
            measurementId: "G-152H1KMSHH"
        };

        if (!firebase.apps.length) {
            try { firebase.initializeApp(firebaseConfig); } 
            catch (e) { console.error("Firebase init error:", e); }
        }
        const db = firebase.firestore();
        const auth = firebase.auth();

        const TODAY_ISO = new Date().toISOString().split('T')[0];
        const APP_ID = 'pushups-15-weeks';

        const DEFAULT_PLAN = {
            1:  [18, 18, 12, 12, 10], 2:  [22, 22, 15, 15, 12], 3:  [25, 25, 18, 18, 15],
            4:  [28, 28, 20, 20, 18], 5:  [32, 32, 24, 24, 20], 6:  [35, 35, 26, 26, 22],
            7:  [38, 38, 30, 30, 25], 8:  [42, 42, 32, 32, 28], 9:  [45, 45, 35, 35, 30],
            10: [48, 48, 38, 38, 32], 11: [52, 52, 40, 40, 35], 12: [55, 55, 42, 42, 38],
            13: [58, 58, 44, 44, 38], 14: [62, 62, 45, 45, 40], 15: [65, 65, 45, 45, 40]
        };

        const WEEKLY_TIPS = {
            1: "–¢–∏–∂–¥–µ–Ω—å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è. –ó–æ—Å–µ—Ä–µ–¥—å—Å—è –Ω–∞ —Ç–µ—Ö–Ω—ñ—Ü—ñ.",
            2: "–°–ª—É—Ö–∞–π —Ç—ñ–ª–æ. –Ø–∫—â–æ –±–æ–ª—è—Ç—å —Å—É–≥–ª–æ–±–∏ ‚Äî –≤—ñ–¥–ø–æ—á–∏–Ω—å.",
            3: "–î–∏—Ö–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–∏–¥–∏—Ö –Ω–∞ –∑—É—Å–∏–ª–ª—ñ.",
            4: "–¢—Ä–∏–º–∞–π —Å–ø–∏–Ω—É —Ä—ñ–≤–Ω–æ, –Ω–∞–ø—Ä—É–∂ –ø—Ä–µ—Å.",
            5: "–ö—Ä–∞—â–µ –º–µ–Ω—à–µ, –∞–ª–µ –∑ –ø–æ–≤–Ω–æ—é –∞–º–ø–ª—ñ—Ç—É–¥–æ—é.",
            6: "–ü–∏–π –≤–æ–¥—É –¥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è.",
            7: "–û–ø—É—Å–∫–∞–π—Å—è –ø–æ–≤—ñ–ª—å–Ω–æ, –ø—ñ–¥–Ω—ñ–º–∞–π—Å—è —à–≤–∏–¥–∫–æ.",
            8: "–°–ø–∏ –º—ñ–Ω—ñ–º—É–º 7-8 –≥–æ–¥–∏–Ω –¥–ª—è —Ä–æ—Å—Ç—É –º'—è–∑—ñ–≤.",
            9: "–á–∂ –±—ñ–ª—å—à–µ –±—ñ–ª–∫–∞ (—è–π—Ü—è, –º'—è—Å–æ).",
            10: "–ï–∫–≤–∞—Ç–æ—Ä! –í–º–∏–∫–∞–π –º—É–∑–∏–∫—É –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü—ñ—ó.",
            11: "–î–æ–±—Ä–µ —Ä–æ–∑–º–∏–Ω–∞–π –ø–ª–µ—á—ñ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º.",
            12: "–†–æ–∑—Ç—è–≥—É–π –≥—Ä—É–¥–Ω—ñ –º'—è–∑–∏ –º—ñ–∂ –ø—ñ–¥—Ö–æ–¥–∞–º–∏.",
            13: "–û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–≤—Ç–æ—Ä–∏ –¥–∞—é—Ç—å –Ω–∞–π–±—ñ–ª—å—à–∏–π —Ä—ñ—Å—Ç.",
            14: "–¢–∏ —Å–∏–ª—å–Ω—ñ—à–∏–π, –Ω—ñ–∂ –¥—É–º–∞—î—à.",
            15: "–§—ñ–Ω–∞–ª! –í–∏–∫–ª–∞–¥–∏—Å—å –Ω–∞ –ø–æ–≤–Ω—É."
        };

        const generateId = () => Math.random().toString(36).substring(2, 15);

        const calculateCustomPlan = (startReps, endReps, setsCount) => {
            let plan = {};
            let current = Math.max(1, parseInt(startReps) || 0);
            let target = Math.max(current + 1, parseInt(endReps) || 0);
            let sets = Math.max(1, parseInt(setsCount) || 5);
            let week = 1;
            while (current < target && week < 200) {
                let increase = Math.max(1, Math.ceil(current * 0.1));
                let weeklySet = Array(sets).fill(current);
                weeklySet[sets-1] = Math.max(1, current - Math.ceil(current * 0.1)); 
                plan[week] = weeklySet;
                current += increase;
                if (current > target) current = target;
                week++;
            }
            plan[week] = Array(sets).fill(target);
            return { plan, weeks: week };
        };

        function App() {
            const [currentDate, setCurrentDate] = React.useState(localStorage.getItem('gym_last_date') || TODAY_ISO);
            const [user, setUser] = React.useState(null);
            const [authError, setAuthError] = React.useState(null);
            const [workoutData, setWorkoutData] = React.useState(null);
            const [sessionId, setSessionId] = React.useState(localStorage.getItem('pushup_sync_id') || null);
            const [loading, setLoading] = React.useState(true);
            const [saveStatus, setSaveStatus] = React.useState('idle');
            const [justFinished, setJustFinished] = React.useState(false);
            const [viewMode, setViewMode] = React.useState('edit'); 
            
            const [idOwnerData, setIdOwnerData] = React.useState(null); 
            const [isGlobalOwner, setIsGlobalOwner] = React.useState(false);
            const [inputIds, setInputIds] = React.useState('');

            const [activePlan, setActivePlan] = React.useState(DEFAULT_PLAN);
            const activePlanRef = React.useRef(DEFAULT_PLAN);
            const [planStartDate, setPlanStartDate] = React.useState(TODAY_ISO);
            const planStartDateRef = React.useRef(TODAY_ISO);
            
            const [showSettings, setShowSettings] = React.useState(false);
            const [planSettings, setPlanSettings] = React.useState({ start: 10, end: 50, sets: 5, startDate: TODAY_ISO });
            const [planPreview, setPlanPreview] = React.useState(null);

            React.useEffect(() => { activePlanRef.current = activePlan; }, [activePlan]);
            React.useEffect(() => { planStartDateRef.current = planStartDate; }, [planStartDate]);

            React.useEffect(() => {
                auth.signInAnonymously().catch(err => setAuthError(err.message));
                return auth.onAuthStateChanged(u => setUser(u));
            }, []);

            React.useEffect(() => {
                if (!user || !sessionId) {
                    if (user) setLoading(false);
                    return;
                }
                const safetyTimer = setTimeout(() => setLoading(false), 3000);
                setLoading(true);

                const ownerRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('pushups_owners').doc(sessionId);
                const dataRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('pushups_logs').doc(`${sessionId}_${currentDate}`);

                const unsubOwner = ownerRef.onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        setIdOwnerData(data);
                        if (data.customPlan && JSON.stringify(data.customPlan) !== JSON.stringify(activePlanRef.current)) {
                            setActivePlan(data.customPlan);
                        } else if (!data.customPlan) {
                            setActivePlan(DEFAULT_PLAN);
                        }
                        const loadedStartDate = data.planSettings?.startDate || TODAY_ISO;
                        if (loadedStartDate !== planStartDateRef.current) {
                            setPlanStartDate(loadedStartDate);
                        }
                        const authUsers = data.authorized_users || [data.owner];
                        const isOwner = authUsers.includes(user.uid);
                        setIsGlobalOwner(isOwner);
                        if (viewMode === 'read' && isOwner) setViewMode('edit');
                    } else {
                        setIdOwnerData(null);
                        setIsGlobalOwner(false);
                        setActivePlan(DEFAULT_PLAN);
                        setPlanStartDate(TODAY_ISO);
                        if (viewMode === 'edit') {
                            ownerRef.set({ owner: user.uid, authorized_users: [user.uid], created_at: new Date().toISOString() });
                        }
                    }
                });

                const unsubData = dataRef.onSnapshot(doc => {
                    clearTimeout(safetyTimer);
                    setLoading(false);
                    if (doc.exists) {
                        const data = doc.data();
                        setWorkoutData(data);
                        if (isGlobalOwner && viewMode === 'edit') setSaveStatus('saved');
                        if (data.exercise?.sets?.every(s => s.done) && !justFinished && isGlobalOwner) {
                            triggerConfetti();
                            setJustFinished(true);
                        } else if (!data.exercise?.sets?.every(s => s.done)) {
                            setJustFinished(false);
                        }
                    } else {
                        if (viewMode === 'edit') {
                            const currentSetsCount = (activePlanRef.current[1] || []).length || 5; 
                            dataRef.set({
                                date: currentDate,
                                exercise: {
                                    id: 'pushups_main',
                                    sets: Array.from({ length: currentSetsCount }, (_, i) => ({
                                        id: `set_${generateId()}`,
                                        reps: getSuggestedReps(currentDate, i),
                                        done: false
                                    }))
                                }
                            }).catch(e => console.error(e));
                        } else {
                            setWorkoutData(null);
                        }
                    }
                });
                return () => { unsubOwner(); unsubData(); clearTimeout(safetyTimer); };
            }, [user, currentDate, sessionId, isGlobalOwner, viewMode]);

            const getSuggestedReps = (dateString, setIdx) => {
                try {
                    const start = new Date(planStartDateRef.current);
                    const current = new Date(dateString);
                    const diffDays = Math.floor((current - start) / (1000 * 60 * 60 * 24));
                    if (diffDays < 0) return '';
                    const weekNum = Math.floor(diffDays / 7) + 1;
                    const plan = activePlanRef.current;
                    const maxWeek = Math.max(...Object.keys(plan).map(Number));
                    const weekPlan = plan[Math.min(weekNum, maxWeek)] || plan[maxWeek];
                    return weekPlan[setIdx] !== undefined ? weekPlan[setIdx].toString() : (weekPlan[0] || '').toString();
                } catch (e) { return ''; }
            };

            const triggerConfetti = () => {
                const end = Date.now() + 2000;
                (function frame() {
                    confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#34d399', '#3b82f6', '#fbbf24'] });
                    confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#34d399', '#3b82f6', '#fbbf24'] });
                    if (Date.now() < end) requestAnimationFrame(frame);
                }());
            };

            const updateEntry = (updatedExercise) => {
                if (!isGlobalOwner) return;
                setSaveStatus('saving');
                const docRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('pushups_logs').doc(`${sessionId}_${currentDate}`);
                docRef.update({ exercise: updatedExercise }).then(() => setSaveStatus('saved')).catch(() => setSaveStatus('error'));
            };

            const toggleDone = (idx) => {
                if (!workoutData || !isGlobalOwner) return;
                const newEx = { ...workoutData.exercise };
                newEx.sets[idx].done = !newEx.sets[idx].done;
                updateEntry(newEx);
            };

            const updateReps = (idx, val) => {
                if (!workoutData || !isGlobalOwner) return;
                const newEx = { ...workoutData.exercise };
                newEx.sets[idx].reps = val;
                updateEntry(newEx);
            };

            const changeDate = (offset) => {
                const d = new Date(currentDate);
                d.setDate(d.getDate() + offset);
                const newDate = d.toISOString().split('T')[0];
                setCurrentDate(newDate);
                if (viewMode === 'edit') localStorage.setItem('gym_last_date', newDate);
                setJustFinished(false);
            };

            const handleDateChange = (e) => {
                if (e.target.value) {
                    setCurrentDate(e.target.value);
                    if (viewMode === 'edit') localStorage.setItem('gym_last_date', e.target.value);
                    setJustFinished(false);
                }
            };

            const handleStart = (e) => {
                e.preventDefault();
                if (!inputIds.trim()) return;
                const id = inputIds.toLowerCase().trim();
                setSessionId(id);
                localStorage.setItem('pushup_sync_id', id);
                setViewMode('edit');
                setLoading(true);
            };

            const logout = () => {
                setSessionId(null);
                localStorage.removeItem('pushup_sync_id');
                setWorkoutData(null);
            };

            const handlePlanPreview = () => {
                const { plan, weeks } = calculateCustomPlan(planSettings.start, planSettings.end, planSettings.sets);
                const months = Math.floor(weeks / 4);
                const leftWeeks = weeks % 4;
                let timeString = `${weeks} —Ç–∏–∂–Ω—ñ–≤`;
                if (months > 0) timeString += ` (~${months} –º—ñ—Å. ${leftWeeks} —Ç–∏–∂.)`;
                setPlanPreview({ weeksCount: weeks, timeString, generatedPlan: plan });
            };

            const saveCustomPlan = async () => {
                if (!planPreview || !isGlobalOwner) return;
                if (!confirm("–¶–µ –æ–Ω–æ–≤–∏—Ç—å –≤–∞—à –ø–ª–∞–Ω. –Ø–∫—â–æ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—ñ–π –¥–µ–Ω—å —â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –≤—ñ–Ω –±—É–¥–µ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤–∞–Ω–∏–π. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?")) return;
                try {
                    const ownerRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('pushups_owners').doc(sessionId);
                    await ownerRef.update({ customPlan: planPreview.generatedPlan, planSettings: planSettings });
                    if (currentDate >= planSettings.startDate) {
                        const dataRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('pushups_logs').doc(`${sessionId}_${currentDate}`);
                        await dataRef.delete(); 
                    }
                    setShowSettings(false);
                    setWorkoutData(null); 
                } catch (e) { alert("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è"); console.error(e); }
            };

            const copyId = () => {
                navigator.clipboard.writeText(sessionId);
                alert("ID —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!");
            };

            // üî• –õ–û–ì–Ü–ö–ê –ü–ê–†–û–õ–Ü–í (–ü–û–í–ï–†–ù–£–¢–û)
            const handleSetPassword = async () => {
                if (!idOwnerData || !isGlobalOwner) return;
                const newPass = prompt("–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ø–∞—Ä–æ–ª—å (–ø—É—Å—Ç–æ, —â–æ–± –≤–∏–¥–∞–ª–∏—Ç–∏):");
                if (newPass === null) return; 
                const ownerRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('pushups_owners').doc(sessionId);
                try { await ownerRef.update({ password: newPass }); alert("–ì–æ—Ç–æ–≤–æ!"); } catch (e) { alert("–ü–æ–º–∏–ª–∫–∞."); }
            };

            const handleUnlock = async () => {
                if (!idOwnerData || !idOwnerData.password) return;
                const attempt = prompt("–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:");
                if (attempt === idOwnerData.password) {
                    const ownerRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('pushups_owners').doc(sessionId);
                    try { await ownerRef.update({ authorized_users: firebase.firestore.FieldValue.arrayUnion(user.uid) }); alert("–£—Å–ø—ñ—Ö!"); } catch (e) { alert("–ü–æ–º–∏–ª–∫–∞."); }
                } else { alert("–ù–µ–≤—ñ—Ä–Ω–æ!"); }
            };

            if (authError) return <div className="h-screen flex items-center justify-center text-red-500">–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É (Firebase).</div>;

            if (!sessionId && user) {
                return (
                    <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-6 text-center">
                        <div className="max-w-md w-full space-y-8 animate-pop">
                            <h1 className="text-4xl font-black italic text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-200">PUSH-UP 15</h1>
                            <form onSubmit={handleStart} className="bg-slate-800 p-8 rounded-3xl border border-slate-700 shadow-2xl space-y-4">
                                <label className="text-xs font-bold text-blue-400 uppercase">–í–≤–µ–¥—ñ—Ç—å ID –∫—ñ–º–Ω–∞—Ç–∏</label>
                                <input type="text" value={inputIds} onChange={(e) => setInputIds(e.target.value)} placeholder="artem-gym" className="w-full bg-slate-900 border border-slate-600 rounded-xl p-4 text-white text-lg focus:outline-none focus:border-blue-500" autoFocus />
                                <button type="submit" disabled={!inputIds.trim()} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl transition-all">–£–≤—ñ–π—Ç–∏ / –°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                            </form>
                        </div>
                    </div>
                );
            }

            if (loading) return <div className="h-screen flex items-center justify-center text-blue-500 animate-pulse font-black text-sm">–ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø...</div>;
            if (!user) return <div className="h-screen flex items-center justify-center text-slate-500 text-sm">–í—Ö—ñ–¥...</div>;

            if (showSettings) {
                return (
                    <div className="fixed inset-0 z-50 bg-slate-900/90 flex items-center justify-center p-4">
                        <div className="bg-slate-800 rounded-3xl border border-slate-600 w-full max-w-sm p-6 shadow-2xl animate-pop overflow-y-auto max-h-[90vh]">
                            <div className="flex justify-between mb-4">
                                <h2 className="text-xl font-bold">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
                                <button onClick={() => setShowSettings(false)}>‚úï</button>
                            </div>
                            <div className="space-y-3">
                                <div><label className="text-[10px] uppercase text-slate-400">–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç—É</label><input type="date" value={planSettings.startDate} onChange={e => setPlanSettings({...planSettings, startDate: e.target.value})} className="w-full relative bg-slate-900 border border-slate-600 rounded p-2 text-white"/></div>
                                <div><label className="text-[10px] uppercase text-slate-400">–°—Ç–∞—Ä—Ç (–∫—ñ–ª—å–∫—ñ—Å—Ç—å)</label><input type="number" value={planSettings.start} onChange={e => setPlanSettings({...planSettings, start: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white"/></div>
                                <div><label className="text-[10px] uppercase text-slate-400">–¶—ñ–ª—å (–∫—ñ–ª—å–∫—ñ—Å—Ç—å)</label><input type="number" value={planSettings.end} onChange={e => setPlanSettings({...planSettings, end: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white"/></div>
                                <div><label className="text-[10px] uppercase text-slate-400">–ü—ñ–¥—Ö–æ–¥—ñ–≤</label><input type="number" value={planSettings.sets} onChange={e => setPlanSettings({...planSettings, sets: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white"/></div>
                                
                                <button onClick={handlePlanPreview} className="w-full bg-slate-700 py-3 rounded-xl font-bold mt-2">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
                                {planPreview && <div className="bg-emerald-900/30 p-3 rounded text-center"><p className="text-emerald-400 font-bold">{planPreview.timeString}</p></div>}
                                <button onClick={saveCustomPlan} disabled={!planPreview} className="w-full bg-blue-600 py-3 rounded-xl font-bold disabled:opacity-50 mt-2">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ø–ª–∞–Ω</button>
                            </div>
                        </div>
                    </div>
                );
            }

            const currentWeekCalc = Math.floor((new Date(currentDate) - new Date(planStartDateRef.current)) / (1000 * 60 * 60 * 24 * 7)) + 1;
            const displayWeek = currentWeekCalc > 0 ? currentWeekCalc : '-';
            const tip = WEEKLY_TIPS[Math.max(1, Math.min(currentWeekCalc, 15))] || "–¢–∏ –º–æ–∂–µ—à –≤—Å–µ!";
            const hasPassword = idOwnerData && !!idOwnerData.password;
            
            if (!workoutData && viewMode === 'read') {
                return (
                    <div className="h-screen flex flex-col items-center justify-center bg-slate-900 p-6 text-center space-y-4">
                        <h2 className="text-xl font-bold">–î–∞–Ω–∏—Ö –Ω–µ–º–∞—î üïµÔ∏è‚Äç‚ôÇÔ∏è</h2>
                        <button onClick={logout} className="bg-slate-700 px-6 py-3 rounded-xl">–í–∏–π—Ç–∏</button>
                    </div>
                );
            }

            const doneCount = workoutData?.exercise?.sets ? workoutData.exercise.sets.filter(s => s.done).length : 0;
            const totalSets = workoutData?.exercise?.sets ? workoutData.exercise.sets.length : 5;
            const progressPercent = (doneCount / totalSets) * 100;

            let statusText = isGlobalOwner ? (saveStatus === 'saving' ? '...' : '–í–ª–∞—Å–Ω–∏–∫') : '–ì—ñ—Å—Ç—å';
            let statusColor = isGlobalOwner ? 'text-emerald-500' : 'text-yellow-500';

            return (
                <div className="min-h-screen pb-20 bg-slate-900 text-white">
                    <header className="bg-slate-800/80 backdrop-blur-md p-3 sticky top-0 z-50 shadow-2xl border-b border-white/5">
                        <div className="max-w-md mx-auto flex flex-col gap-3">
                            <div className="flex justify-between items-center">
                                <h1 className="text-lg font-black italic text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-200">üèÜ PUSH-UP 15</h1>
                                <div className="flex gap-2 items-center">
                                    {/* üî• –ö–ù–û–ü–ö–ò –ü–ê–†–û–õ–Æ –ü–û–í–ï–†–ù–£–¢–û */}
                                    {isGlobalOwner && (
                                        <button onClick={() => setShowSettings(true)} className="p-2 rounded-full border border-slate-700 text-slate-400 hover:text-white hover:border-white transition-all">‚öôÔ∏è</button>
                                    )}
                                    {isGlobalOwner ? (
                                        <button onClick={handleSetPassword} className={`p-2 rounded-full border transition-all ${hasPassword ? 'text-emerald-400 border-emerald-500/20 bg-emerald-500/10' : 'text-slate-500 border-slate-700 hover:text-white'}`}>{hasPassword ? 'üîê' : 'üîì'}</button>
                                    ) : (
                                        hasPassword && <button onClick={handleUnlock} className="bg-blue-600/20 text-blue-400 border border-blue-500/50 px-3 py-1 rounded-full text-[10px] font-bold animate-pulse whitespace-nowrap">üîë</button>
                                    )}
                                    
                                    <button onClick={logout} className={`bg-slate-700/50 px-3 py-1 rounded-full text-[10px] border border-slate-600 flex flex-col items-end min-w-[80px]`}>
                                        <span className="font-bold">{sessionId}</span>
                                        <span className={statusColor}>{statusText}</span>
                                    </button>
                                </div>
                            </div>
                            <div className="flex justify-between items-center bg-black/20 p-1.5 rounded-2xl border border-white/5">
                                <button onClick={() => changeDate(-1)} className="p-2 text-xl hover:text-blue-400">‚Äπ</button>
                                <div className="text-center relative w-fit mx-auto group">
                                    <div className="text-[9px] text-blue-400 font-bold uppercase">–¢–∏–∂–¥–µ–Ω—å {displayWeek}</div>
                                    <div className="text-lg font-black">{currentDate}</div>
                                    <input type="date" value={currentDate} onChange={handleDateChange} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                                </div>
                                <button onClick={() => changeDate(1)} className="p-2 text-xl hover:text-blue-400">‚Ä∫</button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto p-4 space-y-5">
                        {/* üî• –ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø –î–õ–Ø –ì–û–°–¢–ï–ô –ü–û–í–ï–†–ù–£–¢–û */}
                        {!isGlobalOwner && (
                             <div className="bg-red-500/10 border border-red-500/30 p-3 rounded-xl text-center mb-2 animate-in fade-in zoom-in">
                                <p className="text-xs text-red-200 font-bold mb-2">üîí –¶–µ–π ID –Ω–∞–ª–µ–∂–∏—Ç—å —ñ–Ω—à–æ–º—É.</p>
                                {hasPassword && <button onClick={handleUnlock} className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-xs font-bold w-full transition-colors">–í–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å</button>}
                            </div>
                        )}

                        <div className="bg-slate-800 rounded-3xl overflow-hidden border border-slate-700 shadow-xl relative">
                            <div className="h-1 w-full bg-slate-700">
                                <div className="h-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500" style={{width: `${progressPercent}%`}}></div>
                            </div>
                            <div className="p-4 bg-slate-700/30 flex justify-between items-center">
                                <div><h2 className="font-bold text-base">–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è</h2><p className="text-[9px] text-slate-400 uppercase">–¶—ñ–ª—å –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</p></div>
                                <div className="flex items-center gap-1 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/20">
                                    <span className="text-emerald-400 text-sm font-black">{doneCount}</span>
                                    <span className="text-emerald-600/50 text-xs font-bold">/</span>
                                    <span className="text-emerald-600 text-xs font-bold">{totalSets}</span>
                                </div>
                            </div>
                            <div className="divide-y divide-slate-700/50">
                                {workoutData?.exercise?.sets && workoutData.exercise.sets.map((set, idx) => (
                                    <div key={set.id} className={`flex items-center p-3 transition-all ${set.done ? 'bg-emerald-900/10' : ''} ${!isGlobalOwner ? 'opacity-50' : ''}`}>
                                        <div className="w-8 text-lg font-black text-slate-600 italic">#{idx + 1}</div>
                                        <div className="flex-1 text-center">
                                            <input value={set.reps} readOnly={!isGlobalOwner} onChange={(e) => updateReps(idx, e.target.value)} className="input-hidden text-2xl font-black bg-transparent text-white" placeholder="0" />
                                            <div className="text-[8px] text-slate-500 uppercase font-bold">–ø–æ–≤—Ç–æ—Ä—ñ–≤</div>
                                        </div>
                                        <button onClick={() => toggleDone(idx)} disabled={!isGlobalOwner} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all active:scale-90 ${set.done ? 'bg-emerald-500 text-white' : 'bg-slate-700 text-slate-500'}`}>
                                            {set.done ? "‚úì" : ""}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-slate-800 p-5 rounded-3xl border border-blue-500/20 relative overflow-hidden shadow-lg">
                            <div className="relative z-10">
                                <div className="flex items-center gap-2 mb-2">
                                    <span className="text-lg">üí°</span>
                                    <h3 className="text-[9px] font-black text-blue-400 uppercase tracking-widest">–ü–æ—Ä–∞–¥–∞</h3>
                                </div>
                                <p className="text-xs text-slate-300">{tip}</p>
                            </div>
                        </div>
                    </main>

                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-800/90 backdrop-blur-xl p-2 rounded-full border border-white/10 shadow-2xl z-50">
                        <button onClick={copyId} className="flex items-center gap-2 text-[10px] font-bold text-slate-300 px-4">üîó –ö–æ–ø—ñ—é–≤–∞—Ç–∏ ID</button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
